<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=2">
<title>üêæ Purple Family Gallery </title>

<!-- Lightbox2 (next/prev) -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.5/css/lightbox.min.css">

<style>
  :root { --bg:#0b0b0b; --fg:#eee; --accent:#8b5cf6; }
  * { box-sizing:border-box; }
  body { margin:0; background:var(--bg); color:var(--fg); font-family:system-ui, Arial, sans-serif; }
  header, footer { max-width:1200px; margin:0 auto; padding:16px; }
  h1 { margin:0; font-size:1.3rem; color:var(--accent); letter-spacing:.3px; }
  .grid {
    max-width:1200px; margin:0 auto; padding:12px 16px 40px;
    display:grid; gap:12px; grid-template-columns:repeat(auto-fill,minmax(220px,1fr));
  }
  .tile { display:block; border-radius:12px; overflow:hidden; border:1px solid #222; transition:transform .15s; }
  .tile:hover { transform: translateY(-2px); }
  .tile img { width:100%; height:220px; object-fit:cover; display:block; background:#1a1a1a; }
  .empty, .error { max-width:1200px; margin:24px auto; padding:12px 16px; opacity:.9; }
  .empty { color:#bbb; }
  .error { color:#ffb4b4; }
</style>
</head>
<body>
<header>
  <h1>üêæ Auto Google Drive Gallery</h1>
  <div class="empty" id="status">Loading photos‚Ä¶</div>
</header>

<main id="gallery" class="grid"></main>

<footer>Powered by paw prints & love üíú</footer>

<!-- Lightbox2 JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.5/js/lightbox.min.js"></script>

<script>
/* =================== CONFIG =================== */
/* Use your working googleusercontent JSON URL here */
const API_URL = "https://script.googleusercontent.com/macros/echo?user_content_key=AehSKLiFtaKrnlHBJmN7N6wvi_ueZYSjC1oxJE7mQo9UJaYQggSu7TSE2TWk28jtNF9zkFgHnrExrIupi_isbegjRB4Hr994SHWh6GwId55TN34vn40QMa03ADckj8jcgLBSjSaUm0cbQvoclmeCCt5X5GbiD4B8rb9S8KGLC1cYYlzNLlTkBUtg9I8xl1zri72aOfUjrpZIPc-q8xXQ7_pH6OGonm9cNWOrB53F9pUtQJEk8ec61ia0IUsJcLSpKry5jD1NViOptV5LBaqkKanL7pUlwB4I4dk1IHMW92uQ&lib=M_tSu8beZ3qYdOBC3NodhF7yTjQUW6d6j";
const CACHE_KEY = "driveGallery:v1";
const CACHE_TTL = 10 * 60 * 1000; // 10 minutes
/* ============================================== */

const wrap   = document.getElementById("gallery");
const status = document.getElementById("status");
const seen   = new Set();

/* === RENDER GALLERY (Next/Prev + Full photo) === */
function render(items){
  if (!Array.isArray(items)) items = [];
  if (items.length === 0 && wrap.childElementCount === 0){
    if (status) status.textContent = "No images found (yet).";
    return;
  }
  if (status && wrap.childElementCount === 0) status.remove();

  items.forEach(p => {
    if (!p || !p.id || seen.has(p.id)) return;
    seen.add(p.id);

    // Full image in lightbox (original photo, scaled to viewport)
    const full  = `https://drive.google.com/uc?export=view&id=${p.id}`;
    // Fast thumbnail for grid cards
    const thumb = `https://drive.google.com/thumbnail?id=${p.id}&sz=w800`;

    const a = document.createElement("a");
    a.className = "tile";
    a.href = full;
    a.setAttribute("data-lightbox","gallery"); // group ALL images ‚Üí next/prev buttons appear
    a.setAttribute("data-title",(p.name || "").replace(/\.[^.]+$/,""));

    const img = document.createElement("img");
    img.src = thumb;
    img.alt = p.name || "Photo";
    img.loading = "lazy";

    a.appendChild(img);
    wrap.appendChild(a);
  });

  if (window.lightbox){
    lightbox.option({
      wrapAround: true,                  // continuous next/prev
      alwaysShowNavOnTouchDevices: true, // show arrows on mobile
      fadeDuration: 120,
      imageFadeDuration: 120,
      resizeDuration: 120,
      positionFromTop: 40,
      disableScrolling: true,
      fitImagesInViewport: true
    });
  }
}

/* === CACHE HELPERS === */
function loadCache(){
  try {
    const s = localStorage.getItem(CACHE_KEY);
    if (!s) return null;
    const { time, items } = JSON.parse(s);
    if (!Array.isArray(items)) return null;
    if (Date.now() - time > CACHE_TTL) return null;
    return items;
  } catch { return null; }
}
function saveCache(items){
  try { localStorage.setItem(CACHE_KEY, JSON.stringify({ time: Date.now(), items })); } catch {}
}

/* === FETCH NEW DATA === */
async function fetchFresh(){
  const url = API_URL + (API_URL.includes("?") ? "&" : "?") + "t=" + Date.now(); // cache-bust
  const r = await fetch(url, { cache:"no-store" });
  if (!r.ok) throw new Error("HTTP " + r.status);
  const items = await r.json();

  const stamp = localStorage.getItem(CACHE_KEY);
  const last  = stamp ? JSON.parse(stamp).items : null;
  const changed = !last || last.length !== (items || []).length;

  if (changed){
    wrap.innerHTML = "";
    seen.clear();
    render(items);
    saveCache(items);
  }
  if (status) status.remove();
}

/* === MAIN START === */
(function start(){
  const cached = loadCache();
  if (cached){
    render(cached);               // instant draw
    if (status) status.textContent = "Refreshing‚Ä¶";
  }
  fetchFresh().catch(err => {
    if (wrap.childElementCount === 0 && status){
      status.className = "error";
      status.textContent = "Failed to load images: " + err.message;
    }
  });
})();
</script>
</body>
</html>



